{% load staticfiles %}
{% block extrahead %}
<link rel="stylesheet" href="{% static 'bodb/css/e-smart-zoom-style.css' %}" type="text/css" media="all" />
<script type="text/javascript" src="{% static 'bodb/scripts/e-smart-zoom-jquery.js' %}"></script>
<script type="text/javascript" src="{% static 'bodb/scripts/jquery.rwdImageMaps.js' %}"></script>
<script type="text/javascript">

    function get{{ connectionGraphId }}ConnectivitySEDIds()
    {
        var ids=[];
        var elems=document.getElementsByName('connectivity_sed_{{ connectionGraphId }}');
        for(var idx=0; idx<elems.length; idx++)
        {
            ids.push(elems[idx].value);
        }
        return ids;
    }

    $(document).ready(function()
    {
		$('#{{ connectionGraphId }}topPositionMap,#{{ connectionGraphId }}leftPositionMap,#{{ connectionGraphId }}rightPositionMap,#{{ connectionGraphId }}bottomPositionMap').bind("click", {{ connectionGraphId }}moveButtonClickHandler);
		$('#{{ connectionGraphId }}zoomInButton,#{{ connectionGraphId }}zoomOutButton').bind("click", {{ connectionGraphId }}zoomButtonClickHandler);

		
        function {{ connectionGraphId }}zoomButtonClickHandler(e){
            var scaleToAdd = 0.8;
            if(e.target.id == '{{ connectionGraphId }}zoomOutButton')
                scaleToAdd = -scaleToAdd;
            $('#{{ connectionGraphId }}').smartZoom('zoom', scaleToAdd);
        }

        function {{ connectionGraphId }}moveButtonClickHandler(e){
            var pixelsToMoveOnX = 0;
            var pixelsToMoveOnY = 0;
            switch(e.target.id){
                case "{{ connectionGraphId }}leftPositionMap":
                    pixelsToMoveOnX = 50;
                break;
                case "{{ connectionGraphId }}rightPositionMap":
                    pixelsToMoveOnX = -50;
                break;
                case "{{ connectionGraphId }}topPositionMap":
                    pixelsToMoveOnY = 50;
                break;
                case "{{ connectionGraphId }}bottomPositionMap":
                    pixelsToMoveOnY = -50;
                break;
            }
            $('#{{ connectionGraphId }}').smartZoom('pan', pixelsToMoveOnX, pixelsToMoveOnY);
        }

        {% for selected,is_favorite,subscribed,sed in connectivity_seds %}
            var count = $('#connectivity_seds').children().length;
            var tmplMarkup = $('#connectivity_sed_{{ connectionGraphId }}-template').html();
            var compiledTmpl = _.template(tmplMarkup,
                    {
                        idx : count+1,
                        id: {{ sed.id }},
                        title: '{{ sed.title|escapejs }}',
                        sed_type: 'connectivity',
                        brief_description: '{{ sed.brief_description|escapejs }}',
                        url_str: '{{ sed.html_url_string|escapejs }}',
                        is_favorite: {% if is_favorite %}true{% else %}false{% endif %},
                        selected: {% if selected %}true{% else %}false{% endif %},
                        title_str: '{{ sed|escapejs }}',
                        draft: {% if sed.draft %}true{% else %}false{% endif %},
                        collator_id: {{ sed.collator.id }},
                        collator: '{{ sed.get_collator_str }}',
                        subscribed_to_user: {% if subscribed %}true{% else %}false{% endif %}
                    }
            );
            $('#connectivity_seds').append(compiledTmpl);
        {% endfor %}
    });
</script>
{% endblock %}
<div id="connectivitySEDData">
    <table class="tab_panel">
        <tr class="section_subheader">
            <td colspan=7>Connectivity SEDs (1-<span id="numConnectivitySEDResults" name="numConnectivitySEDResults">{{ connectivity_seds|length }}</span>)</td>
        </tr>
        {% if not ispopup %}
            {% if can_add_entry or can_remove_entry %}
                <tr class="col_header">
                    <td colspan=7>
                        Workspace Select: {% if can_add_entry %}<a href="../../" onclick="return toggleAllSEDSelect('Connectivity',true,'{{ csrf_token }}');">All</a>{% endif %}{% if can_remove_entry %}, <a href="../../" onclick="return toggleAllSEDSelect('Connectivity',false,'{{ csrf_token }}');">None</a>{% endif %}&nbsp;&nbsp;
                    </td>
                </tr>
            {% endif %}
        {% endif %}
        <tr class="col_header">
            <td width=25px>&nbsp;</td>
            <td style="width:{% if ispopup %}120{% else %}45{% endif %}px">&nbsp;</td>
            <td width=200px>Title</td>
            <td width=200px>Collator</td>
            <td>Description</td>
            <td width=150px>&nbsp;</td>
            <td width=100px>&nbsp;</td>
        </tr>
        <tr>
            <td colspan="7">
                <div id="connectivity_seds" name="connectivity_seds">
                    <input type="hidden" id="groupName" value="{{ connectionGraphId }}"/>
                </div>
            </td>
        </tr>
        {% if not ispopup %}
            <tr class="col_header">
                <td colspan="7">
                    Graph Generation Tool:&nbsp;
                    <select id="{{ connectionGraphId }}Graphtool">
                        <option value="dot">dot</option>
                        <option value="neato">neato</option>
                        <option value="fdp">fdp</option>
                        <option value="sfdp">sfdp</option>
                        <option value="twopi">twopi</option>
                        <option value="circo">circo</option>
                    </select>&nbsp;
                    <a id="{{ connectionGraphId }}Link" href="" onclick="return generateConnDiagram(get{{ connectionGraphId }}ConnectivitySEDIds(),document.getElementById('{{ connectionGraphId }}Graphtool').value,'{{ connectionGraphId }}','{{ csrf_token }}');">Generate Connectivity Graph</a>
                </td>
            </tr>
            <tr class="col_header">
                <td colspan="7">
                    <div id="{{ connectionGraphId }}Div" style="display:none" class="zoomContainer">
                        <div id="positionButtonDiv">
                            <p>Zoom :
                                <span>
                                    <img id="{{ connectionGraphId }}zoomInButton" class="zoomButton" src="{% static 'bodb/images/zoom_assets/zoomIn.png' %}" title="zoom in" alt="zoom in" />
                                    <img id="{{ connectionGraphId }}zoomOutButton" class="zoomButton" src="{% static 'bodb/images/zoom_assets/zoomOut.png' %}" title="zoom out" alt="zoom out" />
                                </span>
                            </p>
                            <p>Pan:
                                <span class="positionButtonSpan">
                                    <map name="{{ connectionGraphId }}positionMap" class="positionMapClass">
                                        <area id="{{ connectionGraphId }}topPositionMap" shape="rect" coords="20,0,40,20" title="move up" alt="move up"/>
                                        <area id="{{ connectionGraphId }}leftPositionMap" shape="rect" coords="0,20,20,40" title="move left" alt="move left"/>
                                        <area id="{{ connectionGraphId }}rightPositionMap" shape="rect" coords="40,20,60,40" title="move right" alt="move right"/>
                                        <area id="{{ connectionGraphId }}bottomPositionMap" shape="rect" coords="20,40,40,60" title="move bottom" alt="move bottom"/>
                                    </map>
                                    <img class="panButton" src="{% static 'bodb/images/zoom_assets/position.png' %}" usemap="#{{ connectionGraphId }}positionMap" />
                                </span>
                            </p>
                        </div>
                        <img src="" usemap="#{{ connectionGraphId }}Map" id="{{ connectionGraphId }}" style="width:100%" origWidth="" origHeight=""/>
                        <map id="{{ connectionGraphId }}Map" name="{{ connectionGraphId }}Map">
                        </map>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="7">
                    <span id="{{ connectionGraphId }}Msg"></span>
                </td>
            </tr>
        {% endif %}
    </table>
</div>

<script type="text/html" id="connectivity_sed_{{ connectionGraphId }}-template">
    <div id="connectivity_sed-<%= idx %>" name="connectivity_sed">
        <input type="hidden" id="connectivity_sed_{{ connectionGraphId }}_<%= id %>" name="connectivity_sed_{{ connectionGraphId }}" value="<%= id %>"/>
        <table class="tab_panel">
            <tr class="<%= getTRTag(idx) %>" valign=top>
                <td width=25px><%= idx %></td>
                <td align=center style="width:{% if ispopup %}120{% else %}45{% endif %}px">
                    {% if user.is_authenticated and not user.is_anonymous  %}
                        {% if ispopup %}
                            {% if multiple %}
                                <a href="../../" onclick="{% ifequal type 'build' %}return opener.addBuildSEDMultiple('', '', '', <%= id %>, ['<%= title.replaceAll('\'','\\\'') %>', '<%= brief_description.replaceAll('\'','\\\'').replaceAll('\n',' ').replaceAll('\r',' ') %>', '<%= sed_type %>']);{% else %}return opener.addTestSEDMultiple('', '', '', <%= id %>, ['<%= title.replaceAll('\'','\\\'') %>', '<%= brief_description.replaceAll('\'','\\\'').replaceAll('\n',' ').replaceAll('\r',' ') %>', '<%= sed_type %>'],'', []);{% endifequal %}">Select</a>
                            {% endif %}
                        {% else %}
                            <a id="favLink" href="" onclick="return toggleFavorite(<%= id %>,'favIcon-<%= id %>','{{ csrf_token }}');">
                                <img id="favIcon-<%= id %>" name="favIcon-<%= id %>" src="<% if(is_favorite){ %>{% static 'bodb/images/star.png' %}<% } else{ %>{% static 'bodb/images/grey_star.png' %}<% } %>"/>
                            </a>
                            <input type=checkbox class="selectedConnectivitySEDCheckbox" name="selectedSEDCheckbox_<%= id %>" id="selectedConnectivitySEDCheckbox_<%= id %>" value="<%= id %>" <% if(selected){ %>checked=True<% } %> <% if(selected){ %> {% if not can_remove_entry %}disabled="True"{% endif %}<% } else{ %>{% if not can_add_entry %}disabled="True"{% endif %}<% } %> onclick="toggleSEDSelect(this.value, '{{ csrf_token }}');"/>
                        {% endif %}
                    {% else %}
                        <input type=checkbox class="selectedConnectivitySEDCheckbox" name="selectedSEDCheckbox_<%= id %>" id="selectedConnectivitySEDCheckbox_<%= id %>" value="<%= id %>" style="display:none"/>
                    {% endif %}
                    <input type=hidden name="selectedSED" id="selectedSED_<%= id %>" value="<%= id %>"/>
                </td>
                <td width=200px>
                    <a href="/bodb/sed/<%= id %>/" onclick="return openInNewTab('/bodb/sed/<%= id %>/');"><%= title_str %></a>
                    <% if(draft){ %><span style="color: red;">&lt;draft&gt;</span><% } %>
                </td>
                <td width=200px><a href="/bodb/user/<%= collator_id %>/"><%= collator %></a> {% if user.is_authenticated and not user.is_anonymous %}<% if(collator_id != {{ user.id }}){ %><% if(subscribed_to_user){ %>Subscribed<% } else{ %><a href="#" title="Be notified when this user creates new entries" onclick="return showPopup('new_user_subscription', 400, 200, '/bodb/subscription/user/new/?_popup=1&user=<%= collator_id %>&type=SED');"><strong>Subscribe</strong></a><% } %><% } %>{% endif %}</td>
                <td><%= brief_description %></td>
                <td width=150px>
                    <%= url_str %>
                </td>
                <td width=100px><span id="sed_<%= id %>_message" name="sed_<%= id %>_message" class="messages"></span></td>
            </tr>
        </table>
    </div>
</script>