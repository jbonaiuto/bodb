<script type="text/javascript">
    function addComponentForm()
    {
        var count = $('#erp_components').children().length;
        var tmplMarkup = $('#erp_component-template').html();
        var compiledTmpl = _.template(tmplMarkup, { id : count });
        $('#erp_components').append(compiledTmpl);
        // update form count
        $('#id_erp_component-TOTAL_FORMS').attr('value', count+1);

        $('#id_erp_component-'+count+'-component_name').poshytip({
            className: 'tip-skyblue',
            content: 'Enter the name of the ERP component.',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 3000
        });

        $('#id_erp_component-'+count+'-latency_peak').poshytip({
            className: 'tip-skyblue',
            content: 'Enter the latency of the peak of the ERP component in ms or a time bin (i.e. 100-200ms).',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 3000
        });

        $('#id_erp_component-'+count+'-latency_peak_type').poshytip({
            className: 'tip-skyblue',
            content: 'Select "exact" for exact peak latency, "approximate" for an estimate of the peak latency, "time window" for a range of peak latencies.',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 3000
        });

        $('#id_erp_component-'+count+'-latency_onset').poshytip({
            className: 'tip-skyblue',
            content: 'Enter the onset latency of the peak of the ERP component.',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 3000
        });

        $('#id_erp_component-'+count+'-amplitude_peak').poshytip({
            className: 'tip-skyblue',
            content: 'Enter the amplitude of the peak of the ERP component (in microV).',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 3000
        });

        $('#id_erp_component-'+count+'-amplitude_mean').poshytip({
            className: 'tip-skyblue',
            content: 'Enter the mean amplitude of the peak of the ERP component (in microV).',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 3000
        });

        $('#id_erp_component-'+count+'-electrode_position_system').poshytip({
            className: 'tip-skyblue',
            content: 'Select the electrode position system used to report the location of the ERP component.',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 3000
        });

        $('#id_erp_component-'+count+'-electrode_position').poshytip({
            className: 'tip-skyblue',
            content: 'Select the electrode position of the ERP component.',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 3000
        });

        $('#id_erp_component-'+count+'-electrode_cap').poshytip({
            className: 'tip-skyblue',
            content: 'Select the electrode cap used.',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 3000
        });

        $('#id_erp_component-'+count+'-channel_number').poshytip({
            className: 'tip-skyblue',
            content: 'Select the channel number the ERP component is reported in.',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 3000
        });

        $('#id_erp_component-'+count+'-source').poshytip({
            className: 'tip-skyblue',
            content: 'Enter the possible sources for the ERP component.',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 3000
        });

        $('#id_erp_component-'+count+'-interpretation').poshytip({
            className: 'tip-skyblue',
            content: 'Enter the interpretation of the ERP component.',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 3000
        });
        $('textarea:not(.processed)').TextAreaResizer();
        return false;
    }
</script>
<div id="erpComponentData" style="display:{% if showFigure %}block{% else %}none{% endif %}">
    <b class="d1f"></b><b class="d2f"></b><b class="d3f"></b><b class="d4f"></b>
    <table class="tab_panel" style="background:#e6e8ed;">
        <tr>
            <td class="table_header">
                <a href="#" class="add-erp_component" onclick="return addComponentForm();">Add new</a>
            </td>
        </tr>
        <tr>
            <td>
                {{ erp_component_formset.management_form }}
                <div class="myerrors">
                    {{ erp_component_formset.management_form.errors }}
                </div>
                <div id="erp_components">
                    {% for erp_component_form in erp_component_formset.forms %}
                        <div id="erp_component-{{ forloop.counter0 }}" name="erp_component">
                            <input type=hidden id="id_erp_component-{{ forloop.counter0 }}-DELETE" name="erp_component-{{ forloop.counter0 }}-DELETE"/>
                            {{ erp_component_form.id }}
                            {{ erp_component_form.erp_sed }}
                            <table class="tab_panel">
                                <tr class="{% cycle 'even_row' 'odd_row' %}" valign=top>
                                    <td style="width:60px">
                                        <a href="" onclick="return deleteInlineForm('erp_component', {{ forloop.counter0 }});">Delete</a>
                                    </td>
                                    <td style="width:120px">Name*</td>
                                    <td colspan="6">
                                        {{ erp_component_form.component_name }}
                                    </td>
                                </tr>
                                <tr class="{% cycle 'even_row' 'odd_row' %}" valign=top>
                                    <td width=60px>&nbsp;</td>
                                    <td>Peak latency*</td>
                                    <td style="width:120px">
                                        {{ erp_component_form.latency_peak }}
                                    </td>
                                    <td style="width:120px;">Peak Latency type*</td>
                                    <td style="width:120px">
                                        {{ erp_component_form.latency_peak_type }}
                                    </td>
                                    <td style="width:120px;">Peak latency onset</td>
                                    <td>
                                        {{ erp_component_form.latency_onset }}
                                    </td>
                                </tr>
                                <tr class="{% cycle 'even_row' 'odd_row' %}" valign=top>
                                    <td width=60px>&nbsp;</td>
                                    <td>Peak amplitude</td>
                                    <td>
                                        {{ erp_component_form.amplitude_peak }}
                                    </td>
                                    <td>Mean amplitude</td>
                                    <td colspan="3">
                                        {{ erp_component_form.amplitude_mean }}
                                    </td>
                                </tr>
                                <tr class="{% cycle 'even_row' 'odd_row' %}" valign=top>
                                    <td width=60px>&nbsp;</td>
                                    <td>Electrode position system*</td>
                                    <td>
                                        {{ erp_component_form.electrode_position_system }}
                                    </td>
                                    <td>Electrode position*</td>
                                    <td colspan="3">
                                        {{ erp_component_form.electrode_position }}
                                    </td>
                                </tr>
                                <tr class="{% cycle 'even_row' 'odd_row' %}" valign=top>
                                    <td width=60px>&nbsp;</td>
                                    <td>Electrode cap</td>
                                    <td colspan="2">
                                        {{ erp_component_form.electrode_cap }}
                                    </td>
                                    <td>Channel</td>
                                    <td colspan="2">
                                        {{ erp_component_form.channel_number }}
                                    </td>
                                </tr>
                                <tr class="{% cycle 'even_row' 'odd_row' %}" valign=top>
                                    <td width=60px>&nbsp;</td>
                                    <td>Source</td>
                                    <td colspan="5">
                                        {{ erp_component_form.source }}
                                    </td>
                                </tr>
                                <tr class="{% cycle 'even_row' 'odd_row' %}" valign=top>
                                    <td width=60px>&nbsp;</td>
                                    <td>Interpretation*</td>
                                    <td colspan="5">
                                        {{ erp_component_form.interpretation }}
                                    </td>
                                </tr>
                                <tr class="{% cycle 'even_row' 'odd_row' %}" valign=top>
                                    <td colspan="7" class="myerrors">
                                        <span id="erp_component_{{ forloop.counter0 }}_errors"></span>
                                    </td>
                                </tr>
                            </table>
                            <div class="myerrors">
                                {{ erp_component_form.errors }}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </td>
        </tr>
    </table>
</div>

<script type="text/html" id="erp_component-template">
    <div id="erp_component-<%= id %>" name="erp_component">
        <input type=hidden id="id_erp_component-<%= id %>-DELETE" name="erp_component-<%= id %>-DELETE"/>
        <input id="id_erp_component-<%= id %>-id" name="erp_component-<%= id %>-id" type="hidden" />
        <input id="id_erp_component-<%= id %>-erp_sed" name="erp_component-<%= id %>-erp_sed" type="hidden" />
        <table class="tab_panel">
            <tr class="<%= getTRTag(id) %>" valign=top>
                <td style="width:60px">
                    <a href="" onclick="return deleteInlineForm('erp_component', <%= id %>);">Delete</a>
                </td>
                <td style="width:120px">Name*</td>
                <td colspan="6">
                    <input id="id_erp_component-<%= id %>-component_name" name="erp_component-<%= id %>-component_name" size="50" type="text" />
                </td>
            </tr>
            <tr class="<%= getTRTag(id) %>" valign=top>
                <td width=60px>&nbsp;</td>
                <td>Peak latency*</td>
                <td style="width:120px">
                    <input id="id_erp_component-<%= id %>-latency_peak" name="erp_component-<%= id %>-latency_peak" size="10" type="text" />
                </td>
                <td style="width:120px;">Peak Latency type*</td>
                <td style="width:120px">
                    <select id="id_erp_component-<%= id %>-latency_peak_type" name="erp_component-<%= id %>-latency_peak_type" style="font-size: 80%;font-family: verdana, sans-serif">
                        <option value="exact">Exact</option>
                        <option value="approx">Approximate</option>
                        <option value="window">Time Window</option>
                    </select>
                </td>
                <td style="width:120px;">Peak latency onset</td>
                <td>
                    <input id="id_erp_component-<%= id %>-latency_onset" name="erp_component-<%= id %>-latency_onset" size="10" type="text" />
                </td>
            </tr>
            <tr class="<%= getTRTag(id) %>" valign=top>
                <td width=60px>&nbsp;</td>
                <td>Peak amplitude</td>
                <td>
                    <input id="id_erp_component-<%= id %>-amplitude_peak" name="erp_component-<%= id %>-amplitude_peak" size="10" type="text" />
                </td>
                <td>Mean amplitude</td>
                <td colspan="3">
                    <input id="id_erp_component-<%= id %>-amplitude_mean" name="erp_component-<%= id %>-amplitude_mean" size="10" type="text" />
                </td>
            </tr>
            <tr class="<%= getTRTag(id) %>" valign=top>
                <td width=60px>&nbsp;</td>
                <td>Electrode position system*</td>
                <td>
                    <select id="id_erp_component-<%= id %>-electrode_position_system" name="erp_component-<%= id %>-electrode_position_system" onchange="updateElectrodePosition(this.id, this.value)" style="font-size: 80%;font-family: verdana, sans-serif">
                        <option value="" selected="selected">---------</option>
                        {% for electrode_position_system in electrode_position_systems %}
                            <option value="{{ electrode_position_system.id }}">{{ electrode_position_system.name }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td>Electrode position*</td>
                <td colspan="3">
                    <select id="id_erp_component-<%= id %>-electrode_position" name="erp_component-<%= id %>-electrode_position" style="font-size: 80%;font-family: verdana, sans-serif">
                        <option value="" selected="selected">---------</option>
                    </select>
                </td>
            </tr>
            <tr class="<%= getTRTag(id) %>" valign=top>
                <td width=60px>&nbsp;</td>
                <td>Electrode cap</td>
                <td colspan="2">
                    <select id="id_erp_component-<%= id %>-electrode_cap" name="erp_component-<%= id %>-electrode_cap" style="font-size: 80%;font-family: verdana, sans-serif">
                        <option value="" selected="selected">---------</option>
                        {% for electrode_cap in electrode_caps %}
                            <option value="{{ electrode_cap.id }}">{{ electrode_cap }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td>Channel</td>
                <td colspan="2">
                    <input id="id_erp_component-<%= id %>-channel_number" name="erp_component-<%= id %>-channel_number" size="5" type="text" />
                </td>
            </tr>
            <tr class="<%= getTRTag(id) %>" valign=top>
                <td width=60px>&nbsp;</td>
                <td>Source</td>
                <td colspan="5">
                    <input id="id_erp_component-<%= id %>-source" name="erp_component-<%= id %>-source" size="50" type="text" />
                </td>
            </tr>
            <tr class="<%= getTRTag(id) %>" valign=top>
                <td width=60px>&nbsp;</td>
                <td>Interpretation*</td>
                <td colspan="5">
                    <textarea cols="57" id="id_erp_component-<%= id %>-interpretation" name="erp_component-<%= id %>-interpretation" rows="3"></textarea>
                </td>
            </tr>
            <tr class="<%= getTRTag(id) %>" valign=top>
                <td colspan="7" class="myerrors">
                    <span id="erp_component_<%= id %>_errors"></span>
                </td>
            </tr>
        </table>
        <div class="myerrors">

        </div>
    </div>
</script>