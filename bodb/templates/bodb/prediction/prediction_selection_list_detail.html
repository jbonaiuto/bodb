<script type="text/javascript">
    function addPredictionForm()
    {
        var count = $('#predictions').children().length;
        var tmplMarkup = $('#prediction-template').html();
        var compiledTmpl = _.template(tmplMarkup, { id : count });
        $('#predictions').append(compiledTmpl);
        // update form count
        $('#id_prediction-TOTAL_FORMS').attr('value', count+1);
        $('#id_prediction-'+count+'-title').poshytip({
            className: 'tip-skyblue',
            content: 'Enter a name for the prediction made by the model.',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 5000
        });
        $('#id_prediction-'+count+'-brief_description').poshytip({
            className: 'tip-skyblue',
            content: 'Enter a brief description of the prediction made by the model.',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 5000
        });
        $('#id_prediction-'+count+'-predictionssr_set-0-ssr_title').poshytip({
            className: 'tip-skyblue',
            content: 'Enter a name for the model simulation results that yield this prediction.',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 5000
        });
        $('#id_prediction-'+count+'-predictionssr_set-0-ssr_brief_description').poshytip({
            className: 'tip-skyblue',
            content: 'Enter a brief description of the model simulation results that yield this prediction.',
            showOn: 'focus',
            showTimeout: 100,
            alignTo: 'target',
            alignY: 'center',
            alignX: 'right',
            offsetX: 5,
            timeOnScreen: 5000
        });
        return false;
    }
</script>
<div id="predictionData" style="display:none">
    <b class="b1f"></b><b class="b2f"></b><b class="b3f"></b><b class="b4f"></b>
    <table class="tab_panel" style="background:#e6e8ed;">
        <tr class="table_header">
            <td colspan=3>
                <a href="#" class="add-figure" onclick="return addPredictionForm();">Add new</a>
            </td>
        </tr>
        <tr class="col_header">
            <td style="width:120px">&nbsp;</td>
            <td style="width:150px">Title*</td>
            <td>Description*</td>
        </tr>
        <tr>
            <td colspan=3>
                {{ prediction_formset.management_form }}
                <div class="myerrors">
                    {{ prediction_formset.management_form.errors }}
                </div>
                <div id="predictions">
                    {% for prediction_form in prediction_formset.forms %}
                        <div id="prediction-{{ forloop.counter0 }}" name="prediction">
                            <input type=hidden id="id_prediction-{{ forloop.counter0 }}-DELETE" name="prediction-{{ forloop.counter0 }}-DELETE"/>
                            {{ prediction_form.id }}
                            {{ prediction_form.document_ptr }}
                            {{ prediction_form.model }}
                            {{ prediction_form.collator }}
                            {{ prediction_form.draft }}
                            {{ prediction_form.public }}
                            <table class="tab_panel">
                                <tr class="{% cycle 'even_row' 'odd_row' %}" valign=top>
                                    <td style="width:120px">
                                        <a href="" onclick="return deleteInlineForm('prediction', {{ forloop.counter0 }});">Remove</a>&nbsp;
                                    </td>
                                    <td style="width:150px">
                                        {{ prediction_form.title }}
                                    </td>
                                    <td width=200px>
                                        {{ prediction_form.brief_description }}
                                    </td>
                                    <td class="myerrors">
                                        <span id="prediction_{{ forloop.counter0 }}_errors">
                                            {{ prediction_form.errors }}
                                        </span>
                                    </td>
                                </tr>
                                <tr class="{% cycle 'even_row' 'odd_row' %}" valign=top>
                                    <td style="width:120px">&nbsp;</td>
                                    <td class="table_header" colspan=3>SSR</td>
                                </tr>
                                <tr class="{% cycle 'even_row' 'odd_row' %}">
                                    <td colspan=4>
                                        <table class="tab_panel">
                                            <tr>
                                                <td style="width:120px">&nbsp;</td>
                                                <td class="col_header" style="width:150px"><i>Title*</i></td>
                                                <td class="col_header"><i>Description</i>*</td>
                                            </tr>
                                            <tr class="{% cycle 'even_row' 'odd_row' %}">
                                                <td colspan=4>
                                                    {{ prediction_form.nested.management_form }}
                                                    <div class="myerrors">
                                                        {{ prediction_form.nested.management_form.errors }}
                                                    </div>
                                                    <div id="prediction-{{ forloop.counter0 }}-ssrs">
                                                        {% for predictionssr_form in prediction_form.nested.forms %}
                                                            <div id="prediction-{{ forloop.parentloop.counter0 }}-ssr-{{ forloop.counter0 }}" name="prediction-{{ forloop.parentloop.counter0 }}-ssr">
                                                                {{ predictionssr_form.id }}
                                                                {{ predictionssr_form.prediction }}
                                                                {{ predictionssr_form.ssr }}
                                                                {{ predictionssr_form.ssr_collator }}
                                                                {{ predictionssr_form.ssr_draft }}
                                                                {{ predictionssr_form.ssr_public }}
                                                                <table class="tab_panel">
                                                                    <tr class="{% cycle 'even_row' 'odd_row' %}" valign=top>
                                                                        <td style="width:120px">&nbsp;</td>
                                                                        <td style="width:150px">
                                                                            {{ predictionssr_form.ssr_title }}
                                                                        </td>
                                                                        <td width=200px>
                                                                            {{ predictionssr_form.ssr_brief_description }}
                                                                        </td>
                                                                        <td class="myerrors">
                                                                            <span id="prediction-{{ forloop.parentloop.counter0 }}-predictionssr_set_{{ forloop.counter0 }}_errors">
                                                                                {{ predictionssr_form.errors }}
                                                                            </span>
                                                                        </td>
                                                                    </tr>
                                                                </table>
                                                            </div>
                                                        {% endfor %}
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    {% endfor %}
                </div>
            </td>
        </tr>
    </table>
</div>

<script type="text/html" id="prediction-template">
    <div id="prediction-<%= id %>" name="prediction">
        <input type=hidden id="id_prediction-<%= id %>-DELETE" name="prediction-<%= id %>-DELETE"/>
        <input id="id_prediction-<%= id %>-model" name="prediction-<%= id %>-model" type="hidden" />
        <input id="id_prediction-<%= id %>-collator" name="prediction-<%= id %>-collator" type="hidden" />
        <input id="id_prediction-<%= id %>-draft" name="prediction-<%= id %>-draft" type="hidden" />
        <input id="id_prediction-<%= id %>-public" name="prediction-<%= id %>-public" type="hidden" />
        <table class="tab_panel">
            <tr class="<%= getTRTag(id) %>" valign=top>
                <td style="width:120px">
                    <a href="" onclick="return deleteInlineForm('prediction', <%= id %>);">Remove</a>&nbsp;
                </td>
                <td style="width:150px">
                    <input id="id_prediction-<%= id %>-title" name="prediction-<%= id %>-title" size="13" type="text" />
                </td>
                <td width=200px>
                    <textarea cols="50" id="id_prediction-<%= id %>-brief_description" name="prediction-<%= id %>-brief_description" rows="3"></textarea>
                </td>
                <td class="myerrors">
                    <span id="prediction_<%= id %>_errors">
                    </span>
                </td>
            </tr>
            <tr class="<%= getTRTag(id) %>" valign=top>
                <td style="width:120px">&nbsp;</td>
                <td class="table_header" colspan=3>SSR</td>
            </tr>
            <tr class="<%= getTRTag(id) %>">
                <td colspan=4>
                    <table class="tab_panel">
                        <tr>
                            <td style="width:120px">&nbsp;</td>
                            <td class="col_header" style="width:150px"><i>Title*</i></td>
                            <td class="col_header"><i>Description</i>*</td>
                        </tr>
                        <tr class="<%= getTRTag(id) %>">
                            <td colspan=4>
                                <input id="id_prediction-<%= id %>-predictionssr_set-TOTAL_FORMS" name="prediction-<%= id %>-predictionssr_set-TOTAL_FORMS" type="hidden" value="1" />
                                <input id="id_prediction-<%= id %>-predictionssr_set-INITIAL_FORMS" name="prediction-<%= id %>-predictionssr_set-INITIAL_FORMS" type="hidden" value="0" />
                                <input id="id_prediction-<%= id %>-predictionssr_set-MAX_NUM_FORMS" name="prediction-<%= id %>-predictionssr_set-MAX_NUM_FORMS" type="hidden" value="1" />
                                <div id="prediction-<%= id %>-ssrs">
                                    <input id="id_prediction-<%= id %>-predictionssr_set-0-id" name="prediction-<%= id %>-predictionssr_set-0-id" type="hidden" />
                                    <input id="id_prediction-<%= id %>-predictionssr_set-0-prediction" name="prediction-<%= id %>-predictionssr_set-0-prediction" type="hidden" />
                                    <input id="id_prediction-<%= id %>-predictionssr_set-0-ssr" name="prediction-<%= id %>-predictionssr_set-0-ssr" type="hidden" />
                                    <input id="id_prediction-<%= id %>-predictionssr_set-0-ssr_collator" name="prediction-<%= id %>-predictionssr_set-0-ssr_collator" type="hidden" />
                                    <input id="id_prediction-<%= id %>-predictionssr_set-0-ssr_draft" name="prediction-<%= id %>-predictionssr_set-0-ssr_draft" type="hidden" />
                                    <input id="id_prediction-<%= id %>-predictionssr_set-0-ssr_public" name="prediction-<%= id %>-predictionssr_set-0-ssr_public" type="hidden" />
                                    <table class="tab_panel">
                                        <tr class="<%= getTRTag(id) %>" valign=top>
                                            <td style="width:120px">&nbsp;</td>
                                            <td style="width:150px">
                                                <input id="id_prediction-<%= id %>-predictionssr_set-0-ssr_title" name="prediction-<%= id %>-predictionssr_set-0-ssr_title" size="13" type="text" />
                                            </td>
                                            <td width=200px>
                                                <textarea cols="50" id="id_prediction-<%= id %>-predictionssr_set-0-ssr_brief_description" name="prediction-<%= id %>-predictionssr_set-0-ssr_brief_description" rows="3"></textarea>
                                            </td>
                                            <td class="myerrors">
                                                <span id="prediction-<%= id %>-predictionssr_set_0_errors">
                                                </span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>
</script>
